# SICNUBOT

SICNUBOT是专为四川师范大学设计用于审核发布消息用的QQ机器人。

## 安装环境

- Web Server(IIS / Apache / nginx / ...)
- PHP (>=7.0)
- MySQL / MariaDB

## 安装方法

导入`mysql/qqbot.sql`到你的数据库，建议为应用单独分配一个用户。  

### 修改配置文件config.php

按照文件中的注释修改`config.php`。

## 使用规范

机器人收到*发布群*的群成员的*私聊消息*后，消息会转发到审核群。在审核群通过审核后会发布到发布群。发布群可以有多个，只要是加入了的群都可以发送统一的消息。

### 待审核消息格式

```
[编号][QQ号码]待审核消息
```

编号由机器人自动指定，一般为递增整数。  
QQ号码为发送者的QQ号码。  

### 带信消息格式

```
[编号][审核人QQ号码]带信内容
```

### 审核

要确认审核通过直接发送消息编号即可。  
如果希望不通过，可以不发送消息或者发送 编号+感叹号 ，注意要使用英文感叹号，不要使用中文感叹号。

比如收到如下消息

```
[89][10032]出售一本《Python-cookbook》，联系17610126666。
```

若通过审核则回复

```
89
```

如果不通过，则发送

```
89!
```

### 带信

如果需要带信给发布消息的人，直接发送 编号 + # + 内容。

比如要带信给编号为89的人，发送信息可以如下

```
89#请提供联系方式
```

对方会收到对应的带信内容，私聊方式。



## 错误类型

程度说明

- 严重，不应该出现的情况，一般为设置出现问题或者软件已失效。
- 警告，使用过程由于误操作造成的问题。

| 错误码 |             说明             | 程度 |
| :----: | :--------------------------: | :--: |
|  101   |         HMAC校验失败         | 严重 |
|  102   | 上报的QQ号码与配置文件不匹配 | 严重 |
|  103   |    上报服务器的IP不是本机    | 严重 |
|  104   |     上报请求方式不是POST     | 严重 |
|  105   |      不是群聊或私聊消息      | 警告 |
|  106   |        数据库连接失败        | 严重 |
|  107   |           程序错误           | 严重 |
|  201   |        审核命令不规范        | 警告 |
|  202   | 审核命令不正确，没有这个编号 | 警告 |
|  203   |       消息已经被审核过       | 警告 |

## 数据库存储方式

数据库存储消息的表是`messages`，含有6个字段

- `code`消息编号，递增序列
- `sender`发此条消息的QQ号
- `time`入库时间，一般等于发消息的时间
- `status`消息审核状态
  - 0=未审核
  - 1=审核通过
  - 2=审核不通过
  - 3=带信，审核不通过
- `message`消息内容
- `reviewer`审核人，未审核时为空